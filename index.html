<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Document Generator - AI Powered</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Animasi Kustom Fade In Up */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen relative pb-20">

    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 md:px-6 py-3 md:py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            
            <div class="flex items-center space-x-3 text-center md:text-left">
                <div class="w-10 h-10 md:w-12 md:h-12 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm border border-white/30 shadow-inner">
                    <i class="fas fa-brain text-xl md:text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold tracking-tight">Scientific Document Generator</h1>
                    <p class="text-xs md:text-sm text-indigo-100">Aplikasi Pendamping untuk Peneliti Pontren Husnul Khotimah</p>
                </div>
            </div>
            
            <div class="flex items-center justify-center space-x-2 md:space-x-3 w-full md:w-auto">
                
                <button onclick="toggleDarkMode()" id="darkModeBtn" class="bg-white/20 hover:bg-white/30 p-2 md:p-3 rounded-xl transition-all shadow-sm backdrop-blur-sm border border-white/30 flex items-center justify-center h-10 md:h-12 w-10 md:w-12 group">
                    <i class="fas fa-moon text-lg md:text-xl text-yellow-300 group-hover:scale-110 transition-transform"></i>
                </button>

                <a href="https://drive.google.com/file/d/1Vy9750AIaY2Gw011Lvl6908IfZCKfr3Q/view?usp=sharing" target="_blank" class="bg-white/20 hover:bg-white/30 text-white px-3 md:px-4 h-10 md:h-12 rounded-xl backdrop-blur-sm border border-white/30 transition-all flex items-center shadow-sm transform hover:scale-105">
                    <i class="fas fa-book-open text-lg md:text-xl md:mr-2"></i>
                    <span class="text-sm font-bold hidden md:inline">Panduan</span>
                </a>

                <div class="hidden lg:flex items-center space-x-3 bg-white/10 px-3 py-1.5 h-12 rounded-xl backdrop-blur-sm border border-white/20">
                    <img src="logo1.png" alt="Logo Pontren" class="h-8 w-auto object-contain rounded-md shadow-sm">
                    <div class="w-px h-6 bg-white/30"></div> 
                    <img src="logo2.png" alt="Logo Kemenag" class="h-8 w-auto object-contain drop-shadow-md">
                    <div class="w-px h-6 bg-white/30"></div> 
                    <img src="logo3.png" alt="Logo Kampus" class="h-8 w-auto object-contain drop-shadow-md">
                </div>
            </div>

        </div>
    </header>

    <main class="container mx-auto px-6 py-8 max-w-7xl">
        <div class="bg-white shadow-sm border rounded-2xl p-4 mb-8">
            <div class="flex justify-between items-center max-w-4xl mx-auto">
                <div class="flex flex-col items-center"><div id="step1-indicator" class="w-10 h-10 rounded-full step-active flex items-center justify-center font-bold mb-2 shadow-inner">1</div><span class="text-xs font-bold text-center mt-1 text-gray-700">Cari Jurnal</span></div>
                <div class="flex-1 h-1 bg-gray-200 mx-2 md:mx-4 rounded"><div id="progress-line" class="h-full bg-gradient-to-r from-indigo-500 to-purple-600 w-0 transition-all duration-500 rounded"></div></div>
                <div class="flex flex-col items-center"><div id="step2-indicator" class="w-10 h-10 rounded-full step-inactive flex items-center justify-center font-bold mb-2 shadow-inner">2</div><span class="text-xs font-bold text-center mt-1 text-gray-700">Kaji Jurnal</span></div>
                <div class="flex-1 h-1 bg-gray-200 mx-2 md:mx-4 rounded"></div>
                <div class="flex flex-col items-center"><div id="step3-indicator" class="w-10 h-10 rounded-full step-inactive flex items-center justify-center font-bold mb-2 shadow-inner">3</div><span class="text-xs font-bold text-center mt-1 text-gray-700">Analisis Gap</span></div>
                <div class="flex-1 h-1 bg-gray-200 mx-2 md:mx-4 rounded"></div>
                <div class="flex flex-col items-center"><div id="step4-indicator" class="w-10 h-10 rounded-full step-inactive flex items-center justify-center font-bold mb-2 shadow-inner">4</div><span class="text-xs font-bold text-center mt-1 text-gray-700">Judul Baru</span></div>
                <div class="flex-1 h-1 bg-gray-200 mx-2 md:mx-4 rounded"></div>
                <div class="flex flex-col items-center"><div id="step5-indicator" class="w-10 h-10 rounded-full step-inactive flex items-center justify-center font-bold mb-2 shadow-inner">5</div><span class="text-xs font-bold text-center mt-1 text-gray-700">Susun Dokumen</span></div>
            </div>
        </div>

        <section id="step1" class="visible-section relative">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Langkah 1: Cari Referensi Jurnal</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">Masukkan keyword topik untuk menemukan jurnal-jurnal akademik yang relevan.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="bg-red-50/50 rounded-2xl p-6 border border-red-100 shadow-sm hover:shadow-md transition-all">
                    <h4 class="font-bold text-red-700 mb-3 flex items-center"><i class="fas fa-flag mr-2 text-xl"></i>Standar Nasional</h4>
                    <ul class="text-sm text-red-800 space-y-3">
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-red-500"></i> <span><strong>SINTA 1 & 2:</strong> Reputasi sangat tinggi (sering disetarakan dengan jurnal internasional).</span></li>
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-red-500"></i> <span><strong>SINTA 3 & 4:</strong> Reputasi menengah (standar umum publikasi sarjana/magister).</span></li>
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-red-500"></i> <span><strong>SINTA 5 & 6:</strong> Standar publikasi dasar.</span></li>
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-red-500"></i> <span><strong>Garuda:</strong> Basis data referensi nasional (sebelum masuk tier SINTA).</span></li>
                    </ul>
                </div>
                
                <div class="bg-blue-50/50 rounded-2xl p-6 border border-blue-100 shadow-sm hover:shadow-md transition-all">
                    <h4 class="font-bold text-blue-700 mb-3 flex items-center"><i class="fas fa-globe mr-2 text-xl"></i>Standar Internasional</h4>
                    <ul class="text-sm text-blue-800 space-y-3">
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-blue-500"></i> <span><strong>Scopus (Q1 & Q2):</strong> Reputasi global tertinggi, berdampak besar pada ilmu pengetahuan.</span></li>
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-blue-500"></i> <span><strong>Scopus (Q3 & Q4):</strong> Reputasi standar internasional yang diakui secara global.</span></li>
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-blue-500"></i> <span><strong>WoS (Web of Science):</strong> Standar indeksasi yang sangat ketat dan prestisius.</span></li>
                        <li class="flex items-start"><i class="fas fa-check-circle mt-1 mr-2 text-blue-500"></i> <span><strong>DOAJ:</strong> Direktori jurnal *Open Access* berkualitas yang melewati tahapan review.</span></li>
                    </ul>
                </div>

                <div class="bg-yellow-50/50 rounded-2xl p-6 border border-yellow-100 shadow-sm hover:shadow-md transition-all">
                    <h4 class="font-bold text-yellow-700 mb-3 flex items-center"><i class="fas fa-lightbulb mr-2 text-xl"></i>Tips Pencarian Jitu</h4>
                    <ul class="text-sm text-yellow-800 space-y-3">
                        <li class="flex items-start"><i class="fas fa-star mt-1 mr-2 text-yellow-500"></i> <span><strong>Aturan 5 Tahun:</strong> Sangat disarankan hanya mengutip jurnal yang terbit di 5 tahun terakhir (State of the Art).</span></li>
                        <li class="flex items-start"><i class="fas fa-star mt-1 mr-2 text-yellow-500"></i> <span><strong>Gunakan Bahasa Inggris:</strong> Algoritma pencarian lebih optimal menemukan jurnal jika keyword di-Inggris-kan.</span></li>
                        <li class="flex items-start"><i class="fas fa-star mt-1 mr-2 text-yellow-500"></i> <span><strong>Tanda Kutip (""):</strong> Gunakan kutip ganda <code>"pendidikan agama"</code> agar frasa tidak terpisah.</span></li>
                        <li class="flex items-start"><i class="fas fa-star mt-1 mr-2 text-yellow-500"></i> <span><strong>Cari "PDF":</strong> Tambahkan kata <code>filetype:pdf</code> di Google Scholar untuk langsung mendownload file utuh.</span></li>
                    </ul>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 border border-gray-100">
                <div class="flex gap-4 mb-4">
                    <div class="flex-1 relative">
                        <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                        <input type="text" id="searchKeyword" placeholder="Contoh: manajemen pendidikan islam, machine learning..." class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none text-lg">
                    </div>
                    <button onclick="searchJournals()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-3 rounded-xl font-semibold hover:shadow-lg transform hover:scale-105 transition-all flex-shrink-0">
                        <i class="fas fa-search md:mr-2"></i><span class="hidden md:inline">Cari Jurnal</span>
                    </button>
                </div>
            </div>

            <div id="searchResults" class="grid gap-4">
                <div class="text-center py-12 text-gray-400">
                    <i class="fas fa-book-open text-6xl mb-4 opacity-30"></i>
                    <p>Hasil pencarian sumber jurnal akan muncul di sini</p>
                </div>
            </div>

            <div class="sticky bottom-0 z-40 bg-gray-50/95 backdrop-blur pt-4 pb-4 border-t border-gray-200 mt-8 flex justify-end hidden" id="nav-step1">
                <button onclick="goToStep(2)" class="bg-gradient-to-r from-green-600 to-teal-600 text-white px-6 py-3 rounded-xl font-semibold shadow-md hover:shadow-lg hover:scale-[1.02] transition-all">Lanjut ke Kajian <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </section>

        <section id="step2" class="hidden-section relative">
            <div class="text-center mb-10"><h2 class="text-3xl font-bold text-gray-800 mb-4">Langkah 2: Kaji Jurnal</h2><p class="text-gray-600">Gunakan API atau Copy prompt ‚Üí Paste ke Gemini + Teks Jurnal ‚Üí Copy hasil ‚Üí Paste ke aplikasi.</p></div>
            <div class="grid lg:grid-cols-2 gap-8 items-stretch">
                <div class="bg-white rounded-2xl shadow-xl p-6 flex flex-col h-full border border-gray-100">
                    <h3 class="text-xl font-bold mb-4 flex items-center text-indigo-600"><i class="fas fa-magic mr-3"></i>Prompt & Input Jurnal</h3>
                    
                    <div class="bg-gray-900 rounded-xl p-3 mb-4 relative overflow-hidden h-32 flex-shrink-0 border border-gray-700">
                        <button onclick="copyPromptText('step2-prompt')" class="copy-btn absolute top-2 right-2 bg-indigo-600 text-white px-3 py-1 rounded text-xs hover:bg-indigo-700 z-10" data-prompt-id="step2-prompt"><i class="fas fa-copy mr-1"></i>Copy</button>
                        <div class="absolute inset-0 p-3 overflow-y-auto mt-8 custom-scrollbar">
<pre id="step2-prompt" class="text-green-400 text-xs whitespace-pre-wrap font-mono m-0">ANALISIS JURNAL - OUTPUT FORMAT JSON MUTLAK

Baca jurnal berikut dan berikan output HANYA dalam format JSON valid (tanpa penjelasan tambahan, tanpa narasi pembuka/penutup):

[INSERT TEKS JURNAL DISINI]

OUTPUT HARUS PERSIS FORMAT JSON INI:
{
  "judul": "[Judul Lengkap Jurnal]",
  "penulis": "[Nama1 - Institusi1; Nama2 - Institusi2]",
  "tahun": "[YYYY]",
  "nama_jurnal": "[nama lengkap jurnal]",
  "publisher": "[nama publisher]",
  "volume": "[angka]",
  "issue": "[angka]",
  "issn": "[kode]",
  "doi": "[isi atau 'Tidak tersedia']",
  "halaman": "[halaman]",
  "keywords": ["[keyword1]", "[keyword2]", "[keyword3]"],
  "bahasa": "[Indonesia/Inggris]",
  "research_gap": "[3-5 kalimat ringkas temuan gap]",
  "tujuan": ["[poin 1]", "[poin 2]"],
  "metode_singkat": "[jenis, alat utama, platform]",
  "hasil_utama": "[temuan kunci 1-2 kalimat]"
}</pre>
                        </div>
                    </div>

                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-bold text-gray-700 text-sm flex items-center">
                            <i class="fas fa-file-pdf text-red-500 mr-2"></i>Teks Jurnal:
                        </h4>
                        <label class="cursor-pointer bg-red-50 text-red-600 hover:bg-red-600 hover:text-white px-4 py-1.5 rounded-lg text-xs font-bold border border-red-200 transition-all flex items-center shadow-sm">
                            <i class="fas fa-upload mr-2"></i> Upload PDF Otomatis
                            <input type="file" id="pdfFileInput" accept="application/pdf" class="hidden" onchange="extractTextFromPDF(event)">
                        </label>
                    </div>
                    <div class="flex-grow mb-4 relative min-h-[150px]">
                        <textarea id="rawJournalInput" class="w-full h-full absolute inset-0 p-3 border-2 border-indigo-100 rounded-xl focus:border-indigo-500 focus:outline-none text-sm resize-none custom-scrollbar bg-indigo-50/30 dark:bg-gray-800 dark:border-gray-600" placeholder="Khusus Auto API: Paste seluruh teks dari PDF jurnal (abstrak, pendahuluan, metode, hasil) ke kotak ini sebelum klik Auto API..."></textarea>
                    </div>

                    <div class="mt-auto flex gap-3 w-full flex-shrink-0">
                        <button onclick="openGeminiWithPrompt('step2-prompt')" class="flex-1 bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 shadow-sm flex items-center justify-center transition-all">
                            <i class="fas fa-external-link-alt mr-2"></i>Manual Tab
                        </button>
                        <button onclick="generateWithAPI('step2-prompt', 'geminiOutputStep2')" class="flex-1 bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-xl font-bold hover:shadow-lg transform hover:scale-[1.02] border border-purple-500 flex items-center justify-center transition-all">
                            <i class="fas fa-robot mr-2"></i>Auto API
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-xl p-6 flex flex-col h-full border border-gray-100">
                    <h3 class="text-xl font-bold mb-4 flex items-center text-green-600"><i class="fas fa-paste mr-3"></i>Hasil Analisis JSON</h3>
                    <div class="flex-grow mb-4 flex flex-col relative min-h-[300px]">
                        <textarea id="geminiOutputStep2" class="w-full h-full absolute inset-0 p-4 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none font-mono text-sm resize-none custom-scrollbar" placeholder="Hasil JSON dari Gemini (Manual/Auto API) akan muncul di sini..."></textarea>
                    </div>
                    <button onclick="parseStep2Output()" class="mt-auto w-full bg-gradient-to-r from-green-600 to-teal-600 text-white py-4 rounded-xl font-bold hover:shadow-lg transform hover:scale-[1.02] transition-all"><i class="fas fa-magic mr-2"></i>Parse & Simpan Otomatis</button>
                </div>
            </div>
            <div class="mt-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100"><h3 class="text-xl font-bold mb-4 border-b pb-2">Data Jurnal Tersimpan</h3><div id="savedJournalsList" class="space-y-4"></div></div>
            <div class="sticky bottom-0 z-40 bg-gray-50/95 backdrop-blur pt-4 pb-4 border-t border-gray-200 mt-8 flex justify-between">
                <button onclick="goToStep(1)" class="bg-white border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold shadow-sm hover:bg-gray-100"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
                <button onclick="goToStep(3)" class="bg-gradient-to-r from-green-600 to-teal-600 text-white px-6 py-3 rounded-xl font-semibold shadow-md hover:shadow-lg hover:scale-[1.02] transition-all">Lanjut ke Analisis <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </section>

        <section id="step3" class="hidden-section relative">
            <div class="text-center mb-10"><h2 class="text-3xl font-bold text-gray-800 mb-4">Langkah 3: Analisis Multi-Jurnal</h2><p class="text-gray-600">Analisis komparatif otomatis dari kumpulan jurnal tersimpan.</p></div>
            <div class="grid lg:grid-cols-2 gap-8 items-stretch">
                <div class="bg-white rounded-2xl shadow-xl p-6 flex flex-col h-full border border-gray-100">
                    <h3 class="text-xl font-bold mb-4 flex items-center text-purple-600"><i class="fas fa-magic mr-3"></i>Prompt Step 3</h3>
                    <div class="flex-grow flex flex-col mb-4"><div class="bg-gray-900 rounded-xl p-4 relative flex-grow overflow-hidden min-h-[300px]"><button onclick="copyPromptText('step3-prompt')" class="copy-btn absolute top-2 right-2 bg-purple-600 text-white px-3 py-1 rounded text-xs hover:bg-purple-700 z-10" data-prompt-id="step3-prompt"><i class="fas fa-copy mr-1"></i>Copy</button><div class="absolute inset-0 p-4 overflow-y-auto mt-8 custom-scrollbar">
<pre id="step3-prompt" class="text-green-400 text-xs whitespace-pre-wrap font-mono m-0">ANALISIS KOMPARATIF - OUTPUT FORMAT JSON MUTLAK

Analisis kumpulan data jurnal berikut dan berikan output HANYA dalam format JSON valid (tanpa penjelasan tambahan):

[INSERT SEMUA DATA JURNAL DARI STEP 2]

OUTPUT HARUS PERSIS FORMAT JSON INI:
{
  "analisis_tema": {
    "tema_dominan": ["[tema1]", "[tema2]"],
    "metode_umum": ["[metode1]", "[metode2]"],
    "hasil_kontradiktif": "[penjelasan jika ada yang bertentangan]"
  },
  "research_gap": [
    {"kategori": "Gap Metodologi", "detail": "[penjelasan]"},
    {"kategori": "Gap Teknologi", "detail": "[penjelasan]"},
    {"kategori": "Gap Variabel", "detail": "[penjelasan]"}
  ],
  "peluang_baru": [
    {"kategori": "Kombinasi Metode", "detail": "[penjelasan]"},
    {"kategori": "Lokasi/Subjek Baru", "detail": "[penjelasan]"}
  ]
}</pre>
                    </div></div></div>
                    <div class="mt-auto flex gap-3 w-full">
                        <button onclick="openGeminiWithPrompt('step3-prompt')" class="flex-1 bg-purple-600 text-white py-4 rounded-xl font-bold hover:bg-purple-700 shadow-sm flex items-center justify-center transition-all">
                            <i class="fas fa-external-link-alt mr-2"></i>Manual Tab
                        </button>
                        <button onclick="generateWithAPI('step3-prompt', 'geminiOutputStep3')" class="flex-1 bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-xl font-bold hover:shadow-lg transform hover:scale-[1.02] border border-purple-500 flex items-center justify-center transition-all">
                            <i class="fas fa-robot mr-2"></i>Auto API
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-xl p-6 flex flex-col h-full border border-gray-100">
                    <h3 class="text-xl font-bold mb-4 flex items-center text-green-600"><i class="fas fa-paste mr-3"></i>Hasil Analisis JSON</h3>
                    <div class="flex-grow mb-4 flex flex-col relative min-h-[300px]">
                        <textarea id="geminiOutputStep3" class="w-full h-full absolute inset-0 p-4 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none font-mono text-sm resize-none custom-scrollbar" placeholder="Hasil JSON analisis komparatif akan muncul di sini..."></textarea>
                    </div>
                    <button onclick="parseStep3Output()" class="mt-auto w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-xl font-bold hover:shadow-lg transform hover:scale-[1.02] transition-all"><i class="fas fa-magic mr-2"></i>Parse & Simpan Analisis</button>
                </div>
            </div>
            <div class="mt-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100"><h3 class="text-xl font-bold mb-4 border-b pb-2">Ringkasan Analisis Tersimpan</h3><div id="analysisSummary" class="space-y-4"></div></div>
            <div class="sticky bottom-0 z-40 bg-gray-50/95 backdrop-blur pt-4 pb-4 border-t border-gray-200 mt-8 flex justify-between">
                <button onclick="goToStep(2)" class="bg-white border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold shadow-sm hover:bg-gray-100"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
                <button onclick="goToStep(4)" class="bg-gradient-to-r from-green-600 to-teal-600 text-white px-6 py-3 rounded-xl font-semibold shadow-md hover:shadow-lg hover:scale-[1.02] transition-all">Lanjut ke Generate Judul <i class="fas fa-arrow-right ml-2"></i></button>
            </div>
        </section>

        <section id="step4" class="hidden-section relative">
            <div class="text-center mb-10"><h2 class="text-3xl font-bold text-gray-800 mb-4">Langkah 4: Generate Judul Baru</h2><p class="text-gray-600">Generate judul unik berdasarkan research gap untuk dipilih.</p></div>
            <div class="grid lg:grid-cols-2 gap-8 items-stretch">
                <div class="bg-white rounded-2xl shadow-xl p-6 flex flex-col h-full border border-gray-100">
                    <h3 class="text-xl font-bold mb-4 flex items-center text-yellow-600"><i class="fas fa-magic mr-3"></i>Prompt Step 4</h3>
                    <div class="flex-grow flex flex-col mb-4"><div class="bg-gray-900 rounded-xl p-4 relative flex-grow overflow-hidden min-h-[300px]"><button onclick="copyPromptText('step4-prompt')" class="copy-btn absolute top-2 right-2 bg-yellow-600 text-white px-3 py-1 rounded text-xs hover:bg-yellow-700 z-10" data-prompt-id="step4-prompt"><i class="fas fa-copy mr-1"></i>Copy</button><div class="absolute inset-0 p-4 overflow-y-auto mt-8 custom-scrollbar">
<pre id="step4-prompt" class="text-green-400 text-xs whitespace-pre-wrap font-mono m-0">GENERATE JUDUL - OUTPUT FORMAT JSON MUTLAK

Berdasarkan research gap berikut, buatkan 5 rekomendasi judul (tanpa penjelasan tambahan):

[INSERT RESEARCH GAP DARI STEP 3]

OUTPUT HARUS BERUPA ARRAY JSON SEPERTI INI:
[
  {
    "no": 1,
    "judul": "[judul lengkap inovatif]",
    "alasan": "[alasan mengapa judul ini unik/layak]",
    "metode": "[pendekatan metode]",
    "subjek": "[subjek/target]"
  },
  {
    "no": 2,
    "judul": "[judul lengkap]",
    "alasan": "[alasan mengapa judul ini unik/layak]",
    "metode": "[pendekatan metode]",
    "subjek": "[subjek/target]"
  }
]</pre>
                    </div></div></div>
                    <div class="mt-auto flex gap-3 w-full">
                        <button onclick="openGeminiWithPrompt('step4-prompt')" class="flex-1 bg-yellow-600 text-white py-4 rounded-xl font-bold hover:bg-yellow-700 shadow-sm flex items-center justify-center transition-all">
                            <i class="fas fa-external-link-alt mr-2"></i>Manual Tab
                        </button>
                        <button onclick="generateWithAPI('step4-prompt', 'geminiOutputStep4')" class="flex-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white py-4 rounded-xl font-bold hover:shadow-lg transform hover:scale-[1.02] border border-yellow-500 flex items-center justify-center transition-all">
                            <i class="fas fa-robot mr-2"></i>Auto API
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-xl p-6 flex flex-col h-full border border-gray-100">
                    <h3 class="text-xl font-bold mb-4 flex items-center text-green-600"><i class="fas fa-paste mr-3"></i>Hasil Array JSON</h3>
                    <div class="flex-grow mb-4 flex flex-col relative min-h-[300px]">
                        <textarea id="geminiOutputStep4" class="w-full h-full absolute inset-0 p-4 border-2 border-gray-200 rounded-xl focus:border-yellow-500 focus:outline-none font-mono text-sm resize-none custom-scrollbar" placeholder="Hasil Array JSON daftar judul akan muncul di sini..."></textarea>
                    </div>
                    <button onclick="parseStep4Output()" class="mt-auto w-full bg-gradient-to-r from-yellow-500 to-orange-500 text-white py-4 rounded-xl font-bold hover:shadow-lg transform hover:scale-[1.02] transition-all"><i class="fas fa-magic mr-2"></i>Parse & Tampilkan Judul</button>
                </div>
            </div>
            <div class="mt-8 bg-white rounded-2xl shadow-xl p-6 border border-gray-100"><h3 class="text-xl font-bold mb-4 border-b pb-2">Pilih Judul untuk Dikembangkan</h3><div id="titleSelectionList" class="space-y-4"></div></div>
            <div class="sticky bottom-0 z-40 bg-gray-50/95 backdrop-blur pt-4 pb-4 border-t border-gray-200 mt-8 flex justify-between">
                <button onclick="goToStep(3)" class="bg-white border-2 border-gray-300 text-gray-700 px-6 py-3 rounded-xl font-semibold shadow-sm hover:bg-gray-100"><i class="fas fa-arrow-left mr-2"></i>Kembali</button>
            </div>
        </section>

        <div id="step5-container"></div>

    </main>

    <div class="fixed left-1 md:left-6 top-1/2 transform -translate-y-1/2 flex flex-col space-y-2 md:space-y-3 z-50 bg-white/80 backdrop-blur-md p-1 md:p-2 rounded-xl md:rounded-2xl shadow-xl border border-gray-200 transition-all duration-300">
        
        <button onclick="setDocumentType('proposal')" id="btn-mode-proposal" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative shadow-lg transform scale-110 ring-2 ring-indigo-300 ring-offset-1 bg-indigo-600 text-white border-transparent">
            <i class="fas fa-file-alt text-base md:text-xl"></i>
            <span class="absolute left-12 md:left-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl">üìù Proposal (Bab 1-3)</span>
        </button>

        <button onclick="setDocumentType('skripsi')" id="btn-mode-skripsi" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative shadow-sm border bg-yellow-50 text-yellow-600">
            <i class="fas fa-graduation-cap text-base md:text-xl"></i>
            <span class="absolute left-12 md:left-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl">üéì Skripsi (Bab 4-5)</span>
        </button>
        
        <button onclick="setDocumentType('makalah')" id="btn-mode-makalah" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative shadow-sm border bg-emerald-50 text-emerald-600">
            <i class="fas fa-book-open text-base md:text-xl"></i>
            <span class="absolute left-12 md:left-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl">üìö Makalah Akademik</span>
        </button>
        
        <button onclick="setDocumentType('jurnal')" id="btn-mode-jurnal" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative shadow-sm border bg-teal-50 text-teal-600">
            <i class="fas fa-newspaper text-base md:text-xl"></i>
            <span class="absolute left-12 md:left-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl">üì∞ Artikel Jurnal</span>
        </button>
        
        <button onclick="setDocumentType('slr')" id="btn-mode-slr" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative shadow-sm border bg-purple-50 text-purple-600">
            <i class="fas fa-search-plus text-base md:text-xl"></i>
            <span class="absolute left-12 md:left-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl">üîç Review SLR</span>
        </button>
    </div>

    <input type="file" id="file-restore-input" accept=".json" class="hidden" onchange="processRestoreFile(event)">        
    
    <div class="fixed right-1 md:right-6 top-1/2 transform -translate-y-1/2 flex flex-col gap-2 md:gap-3 z-50 bg-white/80 backdrop-blur-md p-1.5 md:p-2.5 rounded-xl md:rounded-2xl shadow-xl border border-gray-200 transition-all duration-300">   
        
        <button onclick="openApiSettings()" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative bg-indigo-50 text-indigo-600 hover:bg-indigo-600 hover:text-white shadow-sm border border-indigo-100">
            <i class="fas fa-key text-base md:text-xl transform group-hover:scale-110 transition-transform"></i>
            <span class="absolute right-12 md:right-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl z-50">Set API Key</span>
        </button>

        <button onclick="downloadBackup()" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white shadow-sm border border-blue-100">
            <i class="fas fa-download text-base md:text-xl transform group-hover:scale-110 transition-transform"></i>
            <span class="absolute right-12 md:right-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl z-50">üíæ Download Backup</span>
        </button>
        
        <button onclick="triggerRestore()" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative bg-green-50 text-green-600 hover:bg-green-600 hover:text-white shadow-sm border border-green-100">
            <i class="fas fa-upload text-base md:text-xl transform group-hover:scale-110 transition-transform"></i>
            <span class="absolute right-12 md:right-16 bg-gray-800 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl z-50">üìÇ Restore Data</span>
        </button>
        
        <div class="pt-2 md:pt-3 border-t border-gray-200">
            <button onclick="showConfirmModal()" class="w-10 h-10 md:w-12 md:h-12 rounded-lg md:rounded-xl flex items-center justify-center transition-all group relative bg-red-50 text-red-600 hover:bg-red-600 hover:text-white shadow-sm border border-red-100">
                <i class="fas fa-power-off text-base md:text-xl transform group-hover:scale-110 transition-transform"></i>
                <span class="absolute right-12 md:right-16 bg-red-600 text-white text-xs md:text-sm px-3 md:px-4 h-10 md:h-12 flex items-center rounded-xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none font-bold shadow-xl z-50">Reset Aplikasi</span>
            </button>
        </div>
    </div>
    
    <div id="customWarningModal" class="fixed inset-0 z-[120] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 max-w-md p-6 relative z-10 transform scale-95 opacity-0 transition-all duration-300 animate-fade-in-up" id="customWarningCard">
            <div class="w-16 h-16 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center text-3xl mb-4 mx-auto shadow-sm"><i class="fas fa-exclamation-triangle"></i></div>
            <h3 class="text-xl font-extrabold text-center text-gray-800 mb-2">Ganti Judul Dokumen?</h3>
            <p class="text-gray-600 text-center text-sm mb-6 leading-relaxed px-4"><span class="font-bold text-red-500">PERINGATAN:</span> Memilih judul baru akan <span class="font-bold text-gray-800">MENGHAPUS</span> seluruh isian bab saat ini.</p>
            <div class="flex gap-3">
                <button onclick="closeWarningModal()" class="flex-1 bg-white border-2 border-gray-300 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-50 shadow-sm">Batal</button>
                <button id="btnConfirmSwitchTitle" class="flex-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white font-bold py-3 rounded-xl hover:shadow-lg hover:scale-[1.02] shadow-orange-500/30">Ya, Ganti & Reset</button>
            </div>
            <p class="text-xs text-center text-gray-400 mt-4">üí° Saran: Klik 'Batal' lalu 'Download Backup' dulu jika data lama penting.</p>
        </div>
    </div>

    <div id="customAlertModal" class="fixed inset-0 z-[110] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-gray-900/40 backdrop-blur-sm transition-opacity" onclick="closeCustomAlert()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 max-w-sm p-6 relative z-10 transform scale-95 opacity-0 transition-all duration-300" id="customAlertCard">
            <div id="customAlertIcon" class="w-14 h-14 rounded-full flex items-center justify-center text-2xl mb-4 mx-auto"></div>
            <h3 id="customAlertTitle" class="text-xl font-bold text-center text-gray-800 mb-2">Pesan</h3>
            <p id="customAlertMessage" class="text-gray-600 text-center text-sm mb-6">Detail pesan.</p>
            <button onclick="closeCustomAlert()" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-xl hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-500/30">Mengerti</button>
        </div>
    </div>

    <div id="customConfirmModal" class="fixed inset-0 z-[110] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-gray-900/40 backdrop-blur-sm transition-opacity" onclick="closeConfirmModal()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 max-w-sm p-6 relative z-10 transform scale-95 opacity-0 transition-all duration-300" id="customConfirmCard">
            <div class="w-14 h-14 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-2xl mb-4 mx-auto"><i class="fas fa-exclamation-triangle"></i></div>
            <h3 class="text-xl font-bold text-center text-gray-800 mb-2">Reset Aplikasi?</h3>
            <p class="text-gray-600 text-center text-sm mb-6">Pastikan Anda sudah men-download backup. Semua progress akan terhapus.</p>
            <div class="flex gap-3">
                <button onclick="closeConfirmModal()" class="flex-1 bg-gray-100 text-gray-700 font-semibold py-3 rounded-xl hover:bg-gray-200 transition-all">Batal</button>
                <button onclick="executeReset()" class="flex-1 bg-red-600 text-white font-semibold py-3 rounded-xl hover:bg-red-700 transition-all shadow-lg shadow-red-500/30">Ya, Reset</button>
            </div>
        </div>
    </div>

    <div id="apiSettingsModal" class="fixed inset-0 z-[130] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity" onclick="closeApiSettings()"></div>
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 max-w-md p-6 relative z-10 animate-fade-in-up">
            <h3 class="text-xl font-bold mb-2 flex items-center text-gray-800"><i class="fas fa-key text-indigo-500 mr-2"></i>Pengaturan API</h3>
            <p class="text-sm text-gray-600 mb-4">Masukkan API Key Google Gemini Anda untuk mode otomatis. Dapatkan gratis di <a href="https://aistudio.google.com/api-keys" target="_blank" class="text-blue-600 underline font-bold">Google AI Studio</a>.</p>
            
            <input type="password" id="geminiApiKeyInput" class="w-full p-3 border-2 border-gray-200 rounded-xl mb-3 focus:border-indigo-500 outline-none" placeholder="AIzaSy...">
            
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-5 rounded-r-xl">
                <p class="text-xs text-yellow-800 leading-relaxed flex items-start">
                    <i class="fas fa-exclamation-triangle mt-0.5 mr-2"></i>
                    <span><strong>Peringatan Keamanan:</strong> Key Anda disimpan di browser lokal (LocalStorage). Jika menggunakan komputer publik/kampus, <strong>WAJIB</strong> hapus key setelah selesai agar tidak disalahgunakan orang lain.</span>
                </p>
            </div>

            <div class="flex gap-2">
                <button onclick="closeApiSettings()" class="flex-1 bg-gray-100 py-3 rounded-xl text-gray-700 font-bold hover:bg-gray-200 text-sm">Batal</button>
                <button onclick="removeApiKey()" class="flex-1 bg-red-50 border border-red-200 py-3 rounded-xl text-red-600 font-bold hover:bg-red-100 text-sm">Hapus Key</button>
                <button onclick="saveApiKey()" class="flex-1 bg-indigo-600 py-3 rounded-xl text-white font-bold hover:bg-indigo-700 shadow-lg text-sm">Simpan</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/html-docx-js@0.3.1/dist/html-docx.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>

    <script src="step5-ui.js"></script>
    <script src="state.js"></script>
    <script src="ui.js"></script>
    <script src="core.js"></script>
</body>
</html>